# Project Context

## Purpose
Система автоматизированного тестирования котельного оборудования (Final Test Hybrid).
Обеспечивает выполнение последовательности тестовых шагов для проверки котлов,
сбор данных с датчиков через OPC-UA, управление исполнительными механизмами,
формирование отчетов и сохранение результатов в базу данных.

## Tech Stack
- **.NET 10** - целевой фреймворк
- **WinForms** - основной UI фреймворк для desktop-приложения
- **Blazor Hybrid** - интеграция веб-компонентов в desktop-приложение
- **OPC-UA** - протокол для связи с ПЛК и промышленным оборудованием
- **PostgreSQL** - база данных для хранения результатов тестирования
- **Entity Framework Core** - ORM для работы с базой данных

## Project Conventions

### Code Style
- Язык: **C#** (последняя версия с .NET 10)
- Использование **partial classes** для разделения больших классов на логические части
- **async/await** для всех асинхронных операций
- Именование на английском языке (классы, методы, свойства)
- Комментарии и UI на русском языке
- Форматирование: стандартные правила C# (4 пробела для отступов)
- Не добавлять лишние комментарии и docstrings без необходимости

### Method & Class Design
- **Минимум control flow** - не больше одного управляющего оператора (if, for, while) на метод
- **Компактные функции** - небольшие методы с единой ответственностью, легко тестируемые
- **Обязательные блоки {}** - для всех конструкций (if, for, while, foreach)
- **Отдельные файлы** - record, class, enum, interface выносить в отдельные файлы
- **Лимит 300 строк** - максимум на класс, при превышении разбивать на partial classes по логике
- **Без оверинжиниринга** - не усложнять код без необходимости
- **Без лишнего защитного программирования** - не добавлять проверки на невозможные сценарии

### Architecture Patterns
- **Strategy Pattern** - для сменных алгоритмов выполнения шагов и режимов сканирования
- **State Machine** - управление состояниями тестового процесса (Idle, Running, Paused, Retry, Finished)
- **WaitGroup Pattern** - синхронизация параллельных операций ожидания колонок/точек
- **Dependency Injection** - внедрение зависимостей через конструкторы и Microsoft.Extensions.DependencyInjection
- **Partial Classes** - разделение сервисов на логические файлы (например, StepTimingService разбит на .cs, .Columns.cs, .Scan.cs)

### Testing Strategy
- Функциональное тестирование через UI
- Интеграционное тестирование связи с OPC-UA
- Ручное тестирование на реальном оборудовании

### Git Workflow
- Фичи разрабатываются в отдельных ветках (например, `retry_end`)
- Коммиты на русском языке с кратким описанием изменений
- Мерж в основную ветку после проверки

## Domain Context

### Основные сущности
- **Step (Шаг)** - единица тестирования, содержит набор точек для проверки
- **Point (Точка)** - конкретный параметр для измерения/установки (температура, давление и т.д.)
- **Column (Колонка)** - логическая группа точек, связанных с одним агрегатом
- **Recipe (Рецепт)** - набор шагов для тестирования конкретного типа котла
- **ScanMode** - режим сканирования (Fixed, Scanning) для определения стабильности значений

### Состояния выполнения
- **Idle** - ожидание запуска
- **Running** - выполнение теста
- **Paused** - пауза
- **Retry** - повторная попытка после ошибки
- **Finished** - завершение

### Timing и Tolerance
- Каждый шаг имеет время выполнения и допустимые отклонения параметров
- Система отслеживает стабильность значений в пределах Tolerance
- Поддержка режима повторов (Retry) при сбоях

## Important Constraints
- Приложение работает на Windows (WinForms)
- Требуется подключение к OPC-UA серверу для работы с оборудованием
- Критична стабильность работы - система управляет реальным оборудованием
- Необходима поддержка работы в оффлайн-режиме (без OPC-UA) для отладки

## External Dependencies
- **OPC-UA Server** - связь с ПЛК и промышленными контроллерами
- **PostgreSQL Database** - хранение рецептов, результатов тестов, истории
- **Modbus** (опционально) - альтернативный протокол связи с оборудованием
