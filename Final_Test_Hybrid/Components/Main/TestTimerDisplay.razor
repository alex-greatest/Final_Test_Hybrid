@implements IDisposable
@inject BoilerState BoilerState

<RadzenCard Class="rz-p-2" Style="background-color: #e0e0e0; min-width: 220px;">
    <RadzenStack Gap="10" AlignItems="AlignItems.Center">
        <RadzenText Style="font-size: 1.8rem; color: black">Время теста</RadzenText>
        <RadzenText Style="font-size: 1.8rem; color: black; font-weight: 700">@_displayTime</RadzenText>
    </RadzenStack>
</RadzenCard>

@code {
    private string _displayTime = "00:00:00";
    private bool _disposed;

    protected override void OnInitialized()
    {
        BoilerState.OnTestTimerTick += OnTimerTick;
        BoilerState.OnCleared += OnCleared;
    }

    private void OnTimerTick()
    {
        if (_disposed) return;
        _displayTime = BoilerState.GetTestDurationFormatted();
        _ = InvokeAsync(StateHasChanged);
    }

    private void OnCleared()
    {
        if (_disposed) return;
        _displayTime = "00:00:00";
        _ = InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        _disposed = true;
        BoilerState.OnTestTimerTick -= OnTimerTick;
        BoilerState.OnCleared -= OnCleared;
    }
}
