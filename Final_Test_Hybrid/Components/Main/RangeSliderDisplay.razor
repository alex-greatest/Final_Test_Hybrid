@using Final_Test_Hybrid.Services.Steps.Infrastructure.Execution.Completion
@inject RangeSliderUiState RangeSliderUiState
@implements IDisposable

<div class="range-slider-display-container">
    @if (!string.IsNullOrEmpty(RangeSliderUiState.Title))
    {
        <div class="range-slider-title">@RangeSliderUiState.Title</div>
    }
    @foreach (var kvp in RangeSliderUiState.GetActiveSliders())
    {
        var data = kvp.Value;
        <RangeSlider
            Label="@data.Label"
            Unit="@data.Unit"
            Min="@data.Min"
            Max="@data.Max"
            Value="@data.Value"
            GreenZoneStart="@data.GreenZoneStart"
            GreenZoneEnd="@data.GreenZoneEnd"
            TickCount="@data.TickCount" />
    }
</div>

@code {
    /// <summary>
    /// Подписывается на событие изменения состояния слайдеров.
    /// </summary>
    protected override void OnInitialized()
    {
        RangeSliderUiState.OnStateChanged += HandleStateChanged;
    }

    /// <summary>
    /// Обрабатывает изменение состояния слайдеров.
    /// </summary>
    private void HandleStateChanged()
    {
        InvokeAsync(StateHasChanged);
    }

    /// <summary>
    /// Отписывается от события при уничтожении компонента.
    /// </summary>
    public void Dispose()
    {
        RangeSliderUiState.OnStateChanged -= HandleStateChanged;
    }
}
