@using Final_Test_Hybrid.Services.Steps.Validation
@using Final_Test_Hybrid.Services.Steps.Infrastructure.Execution.ErrorCoordinator
@using Final_Test_Hybrid.Services.Main.PlcReset
@inject DialogService DialogService
@inject ErrorCoordinator ErrorCoordinator
@inject PlcResetCoordinator PlcResetCoordinator
@implements IDisposable

<div class="missing-recipes-dialog">
    <div class="info-message">
        Шаги требуют отсутствующих рецептов: @MissingRecipes.Count
    </div>
    <RadzenDataGrid Data="@MissingRecipes" TItem="MissingRecipeInfo"
                    AllowPaging="false"
                    AllowSorting="true"
                    Style="flex: 1; min-height: 0;">
        <Columns>
            <RadzenDataGridColumn TItem="MissingRecipeInfo" Property="StepName" Title="Шаг" />
            <RadzenDataGridColumn TItem="MissingRecipeInfo" Property="RecipeAddress" Title="Адрес рецепта" />
        </Columns>
    </RadzenDataGrid>
</div>

@code {
    [Parameter]
    public List<MissingRecipeInfo> MissingRecipes { get; set; } = [];

    protected override void OnInitialized()
    {
        ErrorCoordinator.OnReset += Close;
        PlcResetCoordinator.OnForceStop += Close;
    }

    private void Close() => DialogService.Close();

    public void Dispose()
    {
        ErrorCoordinator.OnReset -= Close;
        PlcResetCoordinator.OnForceStop -= Close;
    }
}
