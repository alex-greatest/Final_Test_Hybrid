@using Final_Test_Hybrid.Components.Main.Modals
@using Final_Test_Hybrid.Services.SpringBoot.Operator
@implements IDisposable

<div class="buttons-row">
    <RadzenButton Text="Авторизация оператора"
                  Icon="person"
                  ButtonStyle="ButtonStyle.Primary"
                  Style="background-color: #1e5fcf"
                  Click="@OpenLoginDialog"
                  Disabled="@OperatorState.IsAuthenticated"/>
    <RadzenButton Text="Выйти"
                  Icon="logout"
                  ButtonStyle="ButtonStyle.Light"
                  Style="color: black"/>
</div>
<div class="field-row field-row-operator">
    <RadzenLabel Text="Имя оператора"/>
    <RadzenTextBox Style="width:100%" Value="@OperatorState.Username" ReadOnly="true"/>
</div>

@code {
    [Inject]
    public required DialogService DialogService { get; set; }
    [Inject]
    public required OperatorState OperatorState { get; set; }

    protected override void OnInitialized()
    {
        OperatorState.OnChange += OnStateChanged;
    }

    private void OnStateChanged()
    {
        InvokeAsync(StateHasChanged);
    }

    private async Task OpenLoginDialog()
    {
        await DialogService.OpenAsync<OperatorLoginDialog>("Авторизация оператора",
            options: new DialogOptions
            {
                Width = "450px",
                CloseDialogOnOverlayClick = false,
                ShowClose = true,
                CssClass = "operator-login-dialog"
            });
    }

    public void Dispose()
    {
        OperatorState.OnChange -= OnStateChanged;
    }
}
