# LEARNING LOG

Короткий активный журнал проекта. Подробные расследования и длинные отчёты выносятся в `LEARNING_LOG_ARCHIVE.md`.

## Политика роста (обязательно)
- Активный файл хранит только последние `30` дней или максимум `40` записей (что наступит раньше).
- Одна запись: максимум `6` пунктов + строка `Ссылки`.
- Подробные логи, альтернативы и длинные обсуждения сразу переносить в `LEARNING_LOG_ARCHIVE.md`.
- При превышении лимита переносить самые старые записи в архив без удаления фактов.
- После каждого значимого изменения фиксировать минимум: `Что изменили`, `Почему`, `Риск/урок`, `Ссылки`.

## Шаблон записи
### YYYY-MM-DD (тема)
- Что изменили:
- Почему:
- Риск/урок:
- Ссылки: `path1`, `path2`

## Активные записи

### 2026-02-07 (диагностика Modbus: 111.txt)
- Что изменили: подтвердили, что `PingCommand` читает данные и не выполняет причинно-следственную валидацию; маппинг идёт по `LastErrorId`.
- Почему: источник истины для прод-ошибок — ЭБУ, а локальные эвристики дают риск ложных трактовок.
- Риск/урок: не подменять слой чтения (`PingCommand`) логикой классификации.
- Ссылки: `Final_Test_Hybrid/Services/Diagnostic/Services/EcuErrorSyncService.cs`

### 2026-02-07 (BoilerLock runtime)
- Что изменили: добавили управляемую через `appsettings` runtime-логику BoilerLock, новый interrupt и recovery-check от вечной паузы.
- Почему: нужна безопасная реакция на блокировки котла без остановки ping-потока.
- Риск/урок: условия постановки/снятия паузы должны быть симметричны, иначе неизбежно зависание.
- Ссылки: `Final_Test_Hybrid/Docs/BoilerLockGuide.md`, `Final_Test_Hybrid/MessageServiceDescription.md`

### 2026-02-07 (документация BoilerLock)
- Что изменили: выделили единый источник истины и оставили короткие ссылки в соседних документах.
- Почему: снизили риск рассинхрона между несколькими описаниями одной логики.
- Риск/урок: один подробный guide + короткие ссылки лучше, чем дублирование.
- Ссылки: `Final_Test_Hybrid/Docs/BoilerLockGuide.md`

### 2026-02-07 (спиннер PLC-подписок)
- Что изменили: спиннер теперь показывается только в фазе реальной подписки после готовности соединения.
- Почему: убрали ложный UX-сигнал на старте без PLC в фазе reconnect/retry.
- Риск/урок: индикатор операции должен быть привязан к реальной фазе выполнения, а не к инверсному флагу «не завершено».
- Ссылки: `Final_Test_Hybrid/Services/OpcUa/PlcSubscriptionState.cs`, `Final_Test_Hybrid/Services/OpcUa/PlcInitializationCoordinator.cs`

### 2026-02-07 (оптимизация LEARNING_LOG)
- Что изменили: ввели ротацию и компактный формат активного лога; развернутую историю вынесли в архив.
- Почему: ограничили рост файла и снизили стоимость чтения контекста.
- Риск/урок: без лимитов и шаблона журнал быстро превращается в несопровождаемый narrative.
- Ссылки: `Final_Test_Hybrid/LEARNING_LOG.md`, `Final_Test_Hybrid/LEARNING_LOG_ARCHIVE.md`

### 2026-02-07 (фикс правил в AGENTS)
- Что изменили: добавили в `AGENTS.md` краткую фиксацию про оптимизацию лога и обязательный контроль размера `LEARNING_LOG.md`.
- Почему: закрепили правило рядом с базовыми рабочими принципами, чтобы не терялось между задачами.
- Риск/урок: если правило не зафиксировано в core-инструкции, команда быстро возвращается к бесконтрольному росту файла.
- Ссылки: `AGENTS.md`, `Final_Test_Hybrid/LEARNING_LOG.md`

### 2026-02-07 (BoilerLock ping-flow: auto-stand + bounded retry)
- Что изменили: в `BoilerLockRuntimeService` добавили ping-flow с обязательной проверкой режима, авто-переходом в `Stand`, retry/cooldown/suppress для `1153=0` и расширенным логом `Doc/Modbus` адресов.
- Почему: убрать ложные/бесконечные попытки сброса в неподходящем режиме и остановить лог-шторм на `IllegalDataAddress`.
- Риск/урок: reset по ping должен быть stateful; без cooldown/suppress сервис в 500ms ping-интервале быстро превращается в генератор повторных ошибок.
- Ссылки: `Final_Test_Hybrid/Services/Diagnostic/Services/BoilerLockRuntimeService.cs`, `Final_Test_Hybrid/Services/Diagnostic/Connection/DiagnosticSettings.cs`, `Final_Test_Hybrid/appsettings.json`
