
1.	Назначение
1.1.	Протокол предназначен для обмена информацией между ЭБУ котлом и диагностической утилитой для ПК, а также со стендом функционального тестирования котла.
1.2.	Протокол должен использоваться для диагностики неисправностей котла и для изменения параметров его работы при проведении функционального тестирования.
2.	Протокол
2.1.	Физический уровень протокола — TTL 3.3 V
2.2.	Канальный уровень протокола — UART 115200 б/с, 8N1.
2.3.	Уровень приложения протокола — ModBus RTU 1.1b3
2.3.1.	Роли: ЭБУ котлом – ведомый; диагностическая утилита для ПК или стенд функционального тестирования — ведущие.
3.	Уровни доступа
3.1.	Поддерживается 3 режима: 
	обычный – для просмотра параметров и внутренних величин. В этом режиме ЭБУ находится изначально;
	инженерный – дополняет обычный режим возможностью изменять параметры;
	стенд – предназначен для функционального тестирования.
3.2.	Переход между режимами осуществляется записью в специальные регистры ключей перехода в режимы.
3.3.	По истечении таймаута 60 с, в течение которого не было обмена по интерфейсу, ЭБУ автоматически переходит в обычный режим.
4.	Диагностические данные
4.1.	Протокол предоставляет доступ к параметрам и внутренним переменным ЭБУ, предназначенных для диагностики.
4.2.	Перечень диагностических данных приведен в таблице 1.
4.3.	Доступ к данным осуществляется через следующие функции ModBus (коды FC):
	FC 3 Read Holding Registers;
	FC 6 Write Single Register;
	FC 16 Write Multiple Registers.
4.4.	Регистрами являются 16-битные области памяти, в которых хранятся данные. Для типов данных, длина которых превышает 16 бит, назначаются 2 и более адреса регистра.
4.5.	Формат данных. Признаки доступа на чтение<R>, запись <W> или и то и другое <RW>. Типы данных:
uint16_t	Беззнаковое целое, 16 бит
int16_t	Целое со знаком, 16 бит
uint32_t	Беззнаковое целое, 32 бита
float	С плавающей точкой, одинарной точности, 32 бит
Для параметров, в которых необходимо передавать дополнительную диагностическую информацию, зарезервированы специальные коды, их значения и расшифровка для каждого типа данных приведены в таблице ниже.
Описание ошибки	int16_t	uint16_t	uint32_t	float
Выход за верхний предел диапазона	+32767 (0x7FFF)	65535 (0xFFFF)	0xFFFFFFFF	NaN (0x7FC00001)
Выход за нижний предел диапазона	  32768 (0x8000)	65534 (0xFFFE)	0xFFFFFFFE	NaN (0x7FC00002)
Ошибка общая	 32767 (0x8001)	65533 (0xFFFD)	0xFFFFFFFD	NaN (0x7FC00000)
4.6.	Работа со скрытыми параметрами
4.6.1.	Существуют параметры, для которых введена специальная логика записи и чтения. Это параметры, помеченные подписью Скрыт1 и Скрыт2 и их не скрытые экземпляры

Параметр	Регистры для чтения	Регистры для записи
	Стенд	Инженерный и обычный	Стенд	Инженерный
3.1.A
Установленное значение выбранного типа котла по мощности.	1002	1002	1147 и 1148
в оба	1002
3.P.P
Установленное значения выбранного типа насоса (обычный или с частотным управлением).	1003	1003	1149 и 1150
в оба	1003
3.P.E
Установленное значение выбранного устройства, осуществляющее контроль давления жидкости в системе (реле давления или датчик давления).	1004	1004	1151 и 1152
в оба	1004
3.P.C
Выбор регулятора давления газа	1157	1157	1158 и 1159 в оба	1157

4.6.2.	В интерфейсе пользователя диагностической утилиты параметр со скрытыми регистрами должен отображаться в одном экземпляре несмотря на то, что он представлен 3 разными регистрами.
4.6.3.	В режиме стенда запись и перезапись таких параметров доступна без ограничений. Если запись нового значения будет выполнена только в один из скрытых параметров, то при чтении будет возвращено значение 0 (не задано). Для успешного задания параметра, должна быть выполнена запись одинаковых значений в регистры скрыт1 и скрыт2.
4.6.4.	В инженерном режиме такие параметры запишутся, только если ЭБУ не пройден функциональный тест. Иными словами, если в регистры с меткой Скрыт1 или Скрыт2 ранее не были записаны одинаковые и отличные от 0 значения. Это ограничение реализуется на стороне ЭБУ 
